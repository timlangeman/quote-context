<?php include("header.php"); ?><script type="text/javascript" src="jquery.md5.js"></script><h2 class="entry-title"><a href="http://www.openpolitics.com/?p=4736" title="Permalink to Adding Quote-Context using jQuery" rel="bookmark">Adding Quote-Context using jQuery</a></h2><p>While revising the references for an <a href="http://www.openpolitics.com/2013/02/16/the-temptation-of-jesus-mercedes-edition/" target="_blank">earlier post</a>, I got the idea of adding contextual info to blockquotes:</p><a href="https://www.biblegateway.com/passage/?search=matthew+4&version=NRSV">Matthew 4</a>:<blockquote><p>Then Jesus was led by the Spirit into the Desert to be tempted by the devil.  After fasting forty days and forty nights, he was hungry.  The tempter came to him and said, “If you are the Son of God, tell the stones to become bread.”</p><p>Jesus answered, “It is written: ‘Man does not live on bread alone, but on every word that comes from the mouth of God.”</p></blockquote><p>Which leads you to find the passage in <a href="https://www.biblegateway.com/passage/?search=Deuteronomy%208&version=NRSV">Deuteronomy</a> that Jesus was quoting and ask: "What was the context of this quote; and can I program something in jQuery to automatically expand this context":</p><a href="https://www.biblegateway.com/passage/?search=Deuteronomy%208&version=NRSV">Deuteronomy 8</a>:<blockquote cite="https://www.biblegateway.com/passage/?search=Deuteronomy+8&amp;version=NRSV"><p>He humbled you by letting you hunger, then by feeding you with manna, with which neither you nor your ancestors were acquainted, in order to make you understand that <strong>one does not live by bread alone, but by every word that comes from the mouth of the Lord</strong>.</p></blockquote><p>Right now I have working code to pull data from a <a href="deuteronomy-8.js">json file</a> and fill divs beforeand after the blockquote.  The next step is to define a process for creating and querying the json quote caches.</p><h3>Pseudo Code</h3><pre>1) Compute the hash of the url and quote2) Lookup a json file with the hash name3) Get the json fileIf the json file exists {   Download it}else {  a) Download citing page and verify that the quote is valid      (restrict to local domain)  b) Download url and parse out before and after sections  c) Save data to json file  d) Send output to browser}</pre><script type="text/javascript">	jQuery("blockquote").each(function(){		if( jQuery(this).attr("cite") ){			var blockcite = jQuery(this);			var quote_hash = jQuery.md5(blockcite.attr("cite") + "|" + blockcite.text());						jQuery.getJSON(quote_hash + ".js", function(json) {				blockcite.before("<div class='quote_context' id='quote_before_" + quote_hash + "'> \					<blockquote class='quote_context'>" + json["before"] + "</blockquote></div>");				blockcite.after("<div class='quote_context' id='quote_after_" + quote_hash + "'> \					<blockquote class='quote_context'>" + json["after"] + "</blockquote></div>");					jQuery("#quote_before_" + quote_hash).hide();				jQuery("#quote_after_" + quote_hash).hide();							});			jQuery(this).before("<div class='quote_arrows' id='context_up_" + quote_hash + "'> \				<a href=\"javascript:toggle_quote('before', 'quote_before_" + quote_hash + "');\">&#9650;</a></div>");			jQuery(this).after("<div class='quote_arrows' id='context_down_" + quote_hash +"'> \				<a href=\"javascript:toggle_quote('after', 'quote_after_" + quote_hash +"');\">&#9660;</a></div>");		}	});</script><?php include("footer.php"); ?>